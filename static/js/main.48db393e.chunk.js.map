{"version":3,"sources":["utils/index.js","components/Card.js","App.js","index.js"],"names":["CARDS","split","map","n","Number","flat","isDescending","numbers","filter","number","index","length","moveCard","piles","movedCard","destinationCard","destinationPileIndex","isEmpty","pileIndex","findIndex","pile","find","c","targetPile","targetPileIndex","cardPileIndex","sourcePile","indexInPile","card","numToMove","allowCheat","isCheat","value","movingCards","slice","validOrder","m","getCardIsActive","activeCard","isActive","activePile","getCanCardMove","useWindowEvent","event","callback","useEffect","window","addEventListener","removeEventListener","Card","onMouseDown","onMouseUp","onTouchStart","cursorState","shouldFollowCursor","isPressed","pressedIndex","deckIndex","canMove","height","innerHeight","width","innerWidth","style","y","mouseY","x","mouseX","z","spring","key","bind","className","transform","zIndex","pointerEvents","initialState","startX","startY","App","useState","setActiveCard","setCursorState","chunk","shuffle","i","setPiles","deck","e","pageX","pageY","topDeltaY","topDeltaX","onMouseMove","diffX","Math","abs","diffY","touches","onCardRelease","clickedCard","preventDefault","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.48db393e.chunk.js","sourcesContent":["import shuffle from 'lodash/shuffle'\nimport chunk from 'lodash/chunk'\nimport { useEffect } from 'react'\n\nconst CARDS = '987654321'\n  .split('')\n  .map(n => Number(n))\n  .map(n => [n, n, n, n])\n  .flat()\n\nexport const shuffleDeck = () =>\n  chunk(\n    shuffle(CARDS).map((n, i) => ({\n      value: n,\n      index: i,\n    })),\n    6,\n  )\n\nexport const isDescending = numbers => {\n  return (\n    numbers.filter((number, index) => {\n      return numbers[index + 1] ? number === numbers[index + 1] + 1 : true\n    }).length === numbers.length\n  )\n}\n\nexport const moveCard = (piles, movedCard, destinationCard) => {\n  const destinationPileIndex = destinationCard.isEmpty\n    ? destinationCard.pileIndex\n    : piles.findIndex(pile => pile.find(c => c.index === destinationCard.index))\n\n  return piles.map((targetPile, targetPileIndex) => {\n    const cardPileIndex = piles.findIndex(pile =>\n      pile.find(c => c.index === movedCard.index),\n    )\n    const sourcePile = piles[cardPileIndex]\n    const indexInPile = sourcePile.findIndex(\n      card => card.index === movedCard.index,\n    )\n    const numToMove = sourcePile.length - indexInPile\n\n    const allowCheat =\n      numToMove === 1 && !movedCard.isCheat && !destinationCard.isCheat\n\n    const isCheat =\n      movedCard.value !== destinationCard.value - 1 && !destinationCard.isEmpty\n\n    const movingCards = sourcePile.slice(indexInPile, indexInPile + numToMove)\n    const validOrder =\n      destinationCard.isEmpty ||\n      (!destinationCard.isCheat &&\n        isDescending([destinationCard.value, ...movingCards.map(m => m.value)]))\n\n    if (cardPileIndex === destinationPileIndex) {\n      return targetPile\n    }\n\n    if (validOrder || allowCheat) {\n      // remove the active movedCard from its pile\n      if (targetPileIndex === cardPileIndex) {\n        return targetPile.slice(0, targetPile.length - numToMove)\n      }\n\n      // add the active movedCard to the target pile\n      if (targetPileIndex === destinationPileIndex) {\n        return [...targetPile, ...movingCards.map(c => ({ ...c, isCheat }))]\n      }\n    }\n\n    return targetPile\n  })\n}\n\nexport function getCardIsActive(activeCard, card, piles) {\n  let isActive = false\n\n  if (activeCard) {\n    const { index } = activeCard\n    isActive = index === card.index\n    const activePile = piles.find(pile => pile.find(c => c.index === index))\n    const activeIndexInPile = activePile.findIndex(c => c.index === index)\n    const indexInPile = activePile.findIndex(c => c.index === card.index)\n    isActive = activeIndexInPile <= indexInPile\n  }\n\n  return isActive\n}\n\nexport const getCanCardMove = (card, piles) => {\n  const pileIndex = piles.findIndex(pile =>\n    pile.find(c => c.index === card.index),\n  )\n  const pile = piles[pileIndex]\n  const cardPileIndex = pile.findIndex(c => c.index === card.index)\n  return isDescending([\n    ...pile.map(c => c.value).slice(cardPileIndex, pile.length),\n  ])\n}\n\nexport const useWindowEvent = (event, callback) => {\n  useEffect(() => {\n    window.addEventListener(event, callback)\n    return () => window.removeEventListener(event, callback)\n  }, [event, callback])\n}\n","import React from 'react'\nimport { Motion, spring } from 'react-motion'\n\nexport const Card = ({\n  card,\n  onMouseDown,\n  onMouseUp,\n  onTouchStart,\n  cursorState,\n}) => {\n  const shouldFollowCursor =\n    cursorState.isPressed &&\n    cursorState.pressedIndex === card.deckIndex &&\n    card.canMove &&\n    card.isActive\n\n  const height = window.innerHeight / 12\n  const width = window.innerWidth / 7\n\n  const style = shouldFollowCursor\n    ? { y: cursorState.mouseY, x: cursorState.mouseX, z: 99 }\n    : {\n        y: spring(height + card.cardPileIndex * height),\n        x: spring(width / 1.8 + card.pileIndex * width),\n        z: 1,\n      }\n\n  return (\n    <Motion key={card.index} style={style}>\n      {({ x, y, z }) => (\n        <div\n          onMouseDown={onMouseDown.bind(null, card, x, y)}\n          onMouseUp={onMouseUp.bind(null, card, x, y)}\n          onTouchStart={onTouchStart.bind(null, card, x, y)}\n          className={`card spades rank${card.value} ${\n            card.isCheat ? 'is-cheat' : ''\n          } ${card.isActive ? 'is-active' : ''} ${card.isEmpty ? 'empty' : ''}`}\n          style={{\n            transform: `translate3d(${x}px, ${y}px, 0)`,\n            zIndex: z,\n            pointerEvents: shouldFollowCursor ? 'none' : 'all',\n          }}\n        >\n          <div className=\"face\" />\n        </div>\n      )}\n    </Motion>\n  )\n}\n","import React, { useState } from 'react'\nimport {\n  shuffleDeck,\n  useWindowEvent,\n  moveCard,\n  getCanCardMove,\n  getCardIsActive,\n} from './utils'\nimport { Card } from './components/Card'\nimport './index.css'\n\nconst initialState = { startX: 0, startY: 0, mouseY: 0, mouseX: 0 }\n\nfunction App() {\n  const [activeCard, setActiveCard] = useState(null)\n  const [cursorState, setCursorState] = useState(initialState)\n  const [piles, setPiles] = useState([...shuffleDeck()])\n\n  const deck = piles.flat()\n\n  const onMouseDown = (card, mouseX, mouseY, e) => {\n    const { pageX: startX, pageY: startY } = e\n    if (activeCard) {\n      setPiles(moveCard(piles, activeCard, card))\n      setActiveCard(null)\n    } else if (\n      card.isActive ||\n      !card.canMove ||\n      (!activeCard && card.isEmpty)\n    ) {\n      setActiveCard(null)\n    } else {\n      setActiveCard(card)\n    }\n\n    setCursorState({\n      topDeltaY: startY - mouseY,\n      topDeltaX: startX - mouseX,\n      mouseY,\n      mouseX,\n      startX,\n      startY,\n      isPressed: true,\n      pressedIndex: card.deckIndex,\n    })\n  }\n\n  const onMouseMove = ({ pageY, pageX }) => {\n    const { isPressed, topDeltaY, topDeltaX } = cursorState\n\n    if (isPressed) {\n      const mouseY = pageY - topDeltaY\n      const mouseX = pageX - topDeltaX\n\n      setCursorState({ ...cursorState, mouseY, mouseX })\n    }\n  }\n\n  const onMouseUp = e => {\n    const diffX = Math.abs(cursorState.startX - e.pageX)\n    const diffY = Math.abs(cursorState.startY - e.pageY)\n\n    if (activeCard && cursorState.pressedIndex && diffX < 10 && diffY < 10) {\n    } else {\n      setActiveCard(null)\n    }\n\n    setCursorState({\n      ...cursorState,\n      isPressed: false,\n      pressedIndex: null,\n      topDeltaY: 0,\n    })\n  }\n\n  const onTouchStart = (card, x, y, e) => {\n    onMouseDown(card, x, y, e.touches[0])\n  }\n\n  const onTouchMove = e => {\n    e.preventDefault()\n    onMouseMove(e.touches[0])\n  }\n\n  const onCardRelease = (clickedCard, x, y, e) => {\n    if (activeCard && clickedCard) {\n      setPiles(moveCard(piles, activeCard, clickedCard))\n    }\n  }\n\n  useWindowEvent('mouseup', onMouseUp)\n  useWindowEvent('touchmove', onTouchMove)\n  useWindowEvent('touchend', onMouseUp)\n  useWindowEvent('mousemove', onMouseMove)\n\n  return piles.map((pile, pileIndex) =>\n    pile.length === 0 ? (\n      <Card\n        key={`pile-${pileIndex}`}\n        card={{ cardPileIndex: 0, pileIndex, isEmpty: true, canMove: true }}\n        onMouseUp={onCardRelease}\n        cursorState={cursorState}\n        onTouchStart={onTouchStart}\n        onMouseDown={onMouseDown}\n      />\n    ) : (\n      pile.map((card, cardPileIndex) => (\n        <Card\n          key={`card-${card.index}`}\n          card={{\n            ...card,\n            isActive: getCardIsActive(activeCard, card, piles),\n            canMove: getCanCardMove(card, piles),\n            deckIndex: deck.findIndex(c => c.index === card.index),\n            pileIndex,\n            cardPileIndex,\n          }}\n          cursorState={cursorState}\n          onMouseUp={onCardRelease}\n          onMouseDown={onMouseDown}\n          onTouchStart={onTouchStart}\n        />\n      ))\n    ),\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}