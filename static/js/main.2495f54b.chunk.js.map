{"version":3,"sources":["utils/index.js","components/Card.js","App.js","index.js"],"names":["CARDS","split","map","n","Number","flat","isDescending","numbers","filter","number","index","length","moveCard","piles","movedCard","destinationCard","destinationPileIndex","isEmpty","pileIndex","findIndex","pile","find","c","targetPile","targetPileIndex","cardPileIndex","sourcePile","indexInPile","card","numToMove","allowCheat","isCheat","value","movingCards","slice","validOrder","m","getCardIsActive","activeCard","isActive","activePile","getCanCardMove","useWindowEvent","event","callback","useEffect","window","addEventListener","removeEventListener","Card","onMouseDown","onMouseUp","cursorState","shouldFollowCursor","isPressed","pressedIndex","deckIndex","canMove","height","innerHeight","width","innerWidth","style","y","mouseY","x","mouseX","z","spring","key","onPointerDown","bind","onPointerUp","className","transform","zIndex","pointerEvents","initialState","startX","startY","App","useState","setActiveCard","setCursorState","chunk","shuffle","i","setPiles","deck","e","pageX","pageY","topDeltaY","topDeltaX","onCardRelease","clickedCard","diffX","Math","abs","diffY","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.2495f54b.chunk.js","sourcesContent":["import shuffle from 'lodash/shuffle'\nimport chunk from 'lodash/chunk'\nimport { useEffect } from 'react'\n\nconst CARDS = '987654321'\n  .split('')\n  .map(n => Number(n))\n  .map(n => [n, n, n, n])\n  .flat()\n\nexport const shuffleDeck = () =>\n  chunk(\n    shuffle(CARDS).map((n, i) => ({\n      value: n,\n      index: i,\n    })),\n    6,\n  )\n\nexport const isDescending = numbers => {\n  return (\n    numbers.filter((number, index) => {\n      return numbers[index + 1] ? number === numbers[index + 1] + 1 : true\n    }).length === numbers.length\n  )\n}\n\nexport const moveCard = (piles, movedCard, destinationCard) => {\n  const destinationPileIndex = destinationCard.isEmpty\n    ? destinationCard.pileIndex\n    : piles.findIndex(pile => pile.find(c => c.index === destinationCard.index))\n\n  return piles.map((targetPile, targetPileIndex) => {\n    const cardPileIndex = piles.findIndex(pile =>\n      pile.find(c => c.index === movedCard.index),\n    )\n    const sourcePile = piles[cardPileIndex]\n    const indexInPile = sourcePile.findIndex(\n      card => card.index === movedCard.index,\n    )\n    const numToMove = sourcePile.length - indexInPile\n\n    const allowCheat =\n      numToMove === 1 && !movedCard.isCheat && !destinationCard.isCheat\n\n    const isCheat =\n      movedCard.value !== destinationCard.value - 1 && !destinationCard.isEmpty\n\n    const movingCards = sourcePile.slice(indexInPile, indexInPile + numToMove)\n    const validOrder =\n      destinationCard.isEmpty ||\n      (!destinationCard.isCheat &&\n        isDescending([destinationCard.value, ...movingCards.map(m => m.value)]))\n\n    if (cardPileIndex === destinationPileIndex) {\n      return targetPile\n    }\n\n    if (validOrder || allowCheat) {\n      // remove the active movedCard from its pile\n      if (targetPileIndex === cardPileIndex) {\n        return targetPile.slice(0, targetPile.length - numToMove)\n      }\n\n      // add the active movedCard to the target pile\n      if (targetPileIndex === destinationPileIndex) {\n        return [...targetPile, ...movingCards.map(c => ({ ...c, isCheat }))]\n      }\n    }\n\n    return targetPile\n  })\n}\n\nexport function getCardIsActive(activeCard, card, piles) {\n  let isActive = false\n\n  if (activeCard) {\n    const { index } = activeCard\n    isActive = index === card.index\n    const activePile = piles.find(pile => pile.find(c => c.index === index))\n    const activeIndexInPile = activePile.findIndex(c => c.index === index)\n    const indexInPile = activePile.findIndex(c => c.index === card.index)\n    isActive = activeIndexInPile <= indexInPile\n  }\n\n  return isActive\n}\n\nexport const getCanCardMove = (card, piles) => {\n  const pileIndex = piles.findIndex(pile =>\n    pile.find(c => c.index === card.index),\n  )\n  const pile = piles[pileIndex]\n  const cardPileIndex = pile.findIndex(c => c.index === card.index)\n  return isDescending([\n    ...pile.map(c => c.value).slice(cardPileIndex, pile.length),\n  ])\n}\n\nexport const useWindowEvent = (event, callback) => {\n  useEffect(() => {\n    window.addEventListener(event, callback)\n    return () => window.removeEventListener(event, callback)\n  }, [event, callback])\n}\n","import React from 'react'\nimport { Motion, spring } from 'react-motion'\n\nexport const Card = ({ card, onMouseDown, onMouseUp, cursorState }) => {\n  const shouldFollowCursor =\n    cursorState.isPressed &&\n    cursorState.pressedIndex === card.deckIndex &&\n    card.canMove &&\n    card.isActive\n\n  const height = window.innerHeight / 12\n  const width = window.innerWidth / 7\n\n  const style = shouldFollowCursor\n    ? { y: cursorState.mouseY, x: cursorState.mouseX, z: 99 }\n    : {\n        y: spring(height + card.cardPileIndex * height),\n        x: spring(width / 1.8 + card.pileIndex * width),\n        z: 1,\n      }\n\n  return (\n    <Motion key={card.index} style={style}>\n      {({ x, y, z }) => (\n        <div\n          onPointerDown={onMouseDown.bind(null, card, x, y)}\n          onPointerUp={onMouseUp.bind(null, card, x, y)}\n          className={`card spades rank${card.value} ${\n            card.isCheat ? 'is-cheat' : ''\n          } ${card.isActive ? 'is-active' : ''} ${card.isEmpty ? 'empty' : ''}`}\n          style={{\n            transform: `translate3d(${x}px, ${y}px, 0)`,\n            zIndex: z,\n            pointerEvents: shouldFollowCursor ? 'none' : 'all',\n          }}\n        >\n          <div className=\"face\" />\n        </div>\n      )}\n    </Motion>\n  )\n}\n","import React, { useState } from 'react'\nimport {\n  shuffleDeck,\n  useWindowEvent,\n  moveCard,\n  getCanCardMove,\n  getCardIsActive,\n} from './utils'\nimport { Card } from './components/Card'\nimport './index.css'\n\nconst initialState = { startX: 0, startY: 0, mouseY: 0, mouseX: 0 }\n\nfunction App() {\n  const [activeCard, setActiveCard] = useState(null)\n  const [cursorState, setCursorState] = useState(initialState)\n  const [piles, setPiles] = useState([...shuffleDeck()])\n\n  const deck = piles.flat()\n\n  const onMouseDown = (card, mouseX, mouseY, e) => {\n    const { pageX: startX, pageY: startY } = e\n    if (activeCard) {\n      setPiles(moveCard(piles, activeCard, card))\n      setActiveCard(null)\n    } else if (\n      card.isActive ||\n      !card.canMove ||\n      (!activeCard && card.isEmpty)\n    ) {\n      setActiveCard(null)\n    } else {\n      setActiveCard(card)\n    }\n\n    setCursorState({\n      topDeltaY: startY - mouseY,\n      topDeltaX: startX - mouseX,\n      mouseY,\n      mouseX,\n      startX,\n      startY,\n      isPressed: true,\n      pressedIndex: card.deckIndex,\n    })\n  }\n\n  const onMouseMove = ({ pageY, pageX }) => {\n    const { isPressed, topDeltaY, topDeltaX } = cursorState\n\n    if (isPressed) {\n      const mouseY = pageY - topDeltaY\n      const mouseX = pageX - topDeltaX\n\n      setCursorState({ ...cursorState, mouseY, mouseX })\n    }\n  }\n\n  const onMouseUp = e => {\n    const diffX = Math.abs(cursorState.startX - e.pageX)\n    const diffY = Math.abs(cursorState.startY - e.pageY)\n\n    if (activeCard && cursorState.pressedIndex && diffX < 10 && diffY < 10) {\n    } else {\n      setActiveCard(null)\n    }\n\n    setCursorState({\n      ...cursorState,\n      isPressed: false,\n      pressedIndex: null,\n      topDeltaY: 0,\n    })\n  }\n\n  const onCardRelease = (clickedCard, x, y, e) => {\n    if (activeCard && clickedCard) {\n      setPiles(moveCard(piles, activeCard, clickedCard))\n    }\n  }\n\n  useWindowEvent('pointerup', onMouseUp)\n  useWindowEvent('pointermove', onMouseMove)\n\n  return piles.map((pile, pileIndex) =>\n    pile.length === 0 ? (\n      <Card\n        key={`pile-${pileIndex}`}\n        card={{ cardPileIndex: 0, pileIndex, isEmpty: true, canMove: true }}\n        onMouseUp={onCardRelease}\n        cursorState={cursorState}\n        onMouseDown={onMouseDown}\n      />\n    ) : (\n      pile.map((card, cardPileIndex) => (\n        <Card\n          key={`card-${card.index}`}\n          card={{\n            ...card,\n            isActive: getCardIsActive(activeCard, card, piles),\n            canMove: getCanCardMove(card, piles),\n            deckIndex: deck.findIndex(c => c.index === card.index),\n            pileIndex,\n            cardPileIndex,\n          }}\n          cursorState={cursorState}\n          onMouseUp={onCardRelease}\n          onMouseDown={onMouseDown}\n        />\n      ))\n    ),\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}